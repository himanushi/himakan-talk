(function(){function b(){var a=navigator.userAgent;return!(a.indexOf("iPhone")>0||a.indexOf("iPod")>0||a.indexOf("Android")>0||a.indexOf("iPad")>0)}function c(a){return'<div class="talk"><div class="user" title="'+a.code+'">'+a.name+'</div><div class="date">'+a.date+'</div><div class="message">'+a.message+"</div></div>\n"}function d(){return window.location.origin.replace(/\//g,"").replace(/\./g,"")}var a="himakan-talk.herokuapp.com";scripts=["http://"+a+"/javascripts/action_cable.min.js","http://"+a+"/javascripts/cable.min.js","https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js","http://code.jquery.com/ui/1.12.1/jquery-ui.min.js"],function(){$.getScriptsSequencial=function(a,b){var c=function(d){$.getScript(a[d],function(){d+1<a.length?c(d+1):b()})};c(0)}}.call(this),function(){b()&&$.getScriptsSequencial(scripts,function(){var b='<div id="himakan_talk"><div id="himakan_talk_title">ひま缶トーク</div><form><input id="user_name" placeholder="名前@パスワード" type="text" value="'+($.cookie("himakan_talk_user_name")||"")+'"><input id="himakan_talk_content" placeholder="会話入力してEnter!!" data-behavior="chat_room_talk" type="text"></form><div id="messages"></div></div>';$("body").append(b).find("#himakan_talk").draggable({containment:"body",scroll:!1}),$.getJSON("http://"+a+"/chat_rooms/"+d(),function(a){for(var b in a)$("#messages").prepend(c(a[b]))}),App.cable.subscriptions.consumer.url="ws://"+a+"/cable",App.chat_room=App.cable.subscriptions.create({channel:"ChatRoomChannel",url:d()},{connected:function(){return console.log("connected!!")},disconnected:function(){return console.log("disconnected!!")},received:function(a){return $("#messages").prepend(c(a)).animate({scrollTop:0},500),$(".talk").first().animate({backgroundColor:"#888"},600).animate({backgroundColor:"#000"},400)},talk:function(a,b,c){return this.perform("talk",{url:d(),user_name:b,message:c})}}),$(document).on("keypress","[data-behavior~=chat_room_talk]",function(a){if(13===a.keyCode)return App.chat_room.talk(d(),$("#user_name").val(),a.target.value),a.target.value="",a.preventDefault(),$.cookie("himakan_talk_user_name",$("#user_name").val())})})}.call(this)}).call(this);