(function(){function e(){var e=navigator.userAgent;return e.indexOf("iPhone")>0||e.indexOf("iPod")>0||e.indexOf("Android")>0||e.indexOf("iPad")>0?!1:!0}function n(e){return'<div class="talk"><div class="user" title="'+e.code+'">'+e.name+'</div><div class="date">'+e.date+'</div><div class="message">'+e.message+"</div></div>\n"}function t(){return window.location.origin.replace(/\//g,"").replace(/\./g,"")}var a="himakan-talk.herokuapp.com";scripts=["http://"+a+"/javascripts/action_cable.min.js","http://"+a+"/javascripts/cable.min.js","https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js","http://code.jquery.com/ui/1.12.1/jquery-ui.min.js"],function(){$.getScriptsSequencial=function(e,n){var t=function(a){$.getScript(e[a],function(){a+1<e.length?t(a+1):n()})};t(0)}}.call(this),function(){e&&$.getScriptsSequencial(scripts,function(){var e='<div id="himakan_talk"><div id="himakan_talk_title">ひま缶トーク</div><form><input id="user_name" placeholder="名前@パスワード" type="text" value="'+($.cookie("himakan_talk_user_name")||"")+'"><input id="himakan_talk_content" placeholder="会話入力してEnter!!" data-behavior="chat_room_talk" type="text"></form><div id="messages"></div></div>';$("body").append(e).find("#himakan_talk").draggable({containment:"body",scroll:!1}),$.getJSON("http://"+a+"/chat_rooms/"+t(),function(e){for(var t in e)$("#messages").prepend(n(e[t]))}),App.cable.subscriptions.consumer.url="ws://"+a+"/cable",App.chat_room=App.cable.subscriptions.create({channel:"ChatRoomChannel",url:t()},{connected:function(){return console.log("connected!!")},disconnected:function(){return console.log("disconnected!!")},received:function(e){return $("#messages").prepend(n(e)),window.scrollTo(0,0)},talk:function(e,n,a){return this.perform("talk",{url:t(),user_name:n,message:a})}}),$(document).on("keypress","[data-behavior~=chat_room_talk]",function(e){return 13===e.keyCode?(App.chat_room.talk(t(),$("#user_name").val(),e.target.value),e.target.value="",e.preventDefault(),$.cookie("himakan_talk_user_name",$("#user_name").val())):void 0})})}.call(this)}).call(this);