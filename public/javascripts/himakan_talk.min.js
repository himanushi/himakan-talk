(function(){function e(){var e=navigator.userAgent;return e.indexOf("iPhone")>0||e.indexOf("iPod")>0||e.indexOf("Android")>0||e.indexOf("iPad")>0?!1:!0}function t(e){return'<div class="talk"><div class="user" title="'+e.code+'">'+e.name+'</div><div class="date">'+e.date+'</div><div class="message">'+e.message+"</div></div>\n"}function a(){return window.location.origin.replace(/\//g,"").replace(/\./g,"")}var n="himakan-talk.herokuapp.com";scripts=["http://"+n+"/javascripts/action_cable.min.js","http://"+n+"/javascripts/cable.min.js","https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js","http://code.jquery.com/ui/1.12.1/jquery-ui.min.js"],function(){$.getScriptsSequencial=function(e,t){var a=function(n){$.getScript(e[n],function(){n+1<e.length?a(n+1):t()})};a(0)}}.call(this),function(){e()&&$.getScriptsSequencial(scripts,function(){var e='<div id="himakan_talk"><div id="himakan_talk_title">ひま缶トーク<span id="himakan_talk_connect_count"></span><a href="http://himakan.net/tool/himakan_talk">詳しくはこちら</a></div><form><input id="user_name" placeholder="名前@パスワード" type="text" value="'+($.cookie("himakan_talk_user_name")||"")+'"><textarea id="himakan_talk_content" data-behavior="chat_room_talk" placeholder="会話入力してEnter!!改行する場合はShift+Enter!!" rows="1" cols="40"></textarea><div id="messages"></div></div>';$("body").append(e).find("#himakan_talk").draggable({containment:"body",scroll:!1,handle:"#himakan_talk_title"}),$.getJSON("http://"+n+"/chat_rooms/"+a(),function(e){for(var a in e)$("#messages").prepend(t(e[a]))}),App.cable.subscriptions.consumer.url="ws://"+n+"/cable",App.chat_room=App.cable.subscriptions.create({channel:"ChatRoomChannel",url:a()},{connected:function(){return console.log("connected!!")},disconnected:function(){return console.log("disconnected!!")},received:function(e){return $("#messages").prepend(t(e)).animate({scrollTop:0},500),$(".talk").first().animate({backgroundColor:"#888"},600).animate({backgroundColor:"#000"},400)},talk:function(e,t,n){return this.perform("talk",{url:a(),user_name:t,message:n})}}),$(document).on("keypress","[data-behavior~=chat_room_talk]",function(e){return 13!==e.keyCode||e.shiftKey?void 0:(App.chat_room.talk(a(),$("#user_name").val(),e.target.value),e.target.value="",e.preventDefault(),$.cookie("himakan_talk_user_name",$("#user_name").val()))}),$.getJSON("http://"+n+"/chat_rooms/connection_count",function(e){$("#himakan_talk_connect_count").text("("+e.count+" online)")})})}.call(this)}).call(this);